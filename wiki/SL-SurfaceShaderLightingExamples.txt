! サーフェスシェーダ ライティングの例

以下は [[SL-Surface Shaders | Surface Shaders]] の  [[SL-SurfaceShaderLighting | $$custom lighting models$$]] のサンプルです。 一般的なサーフェスシェーダの例は、[[SL-SurfaceShaderExamples | this page]] にあります。

遅延ライティングは、カスタムのマテリアルごとのライティング モデルによってはうまく機能しないため、以下のほとんどの例では、シェーダにはフォワード レンダリングにのみコンパイルさせます。


!! 拡散

組み込みランバート ライティング モデルを使用するシェーダから始めましょう。

  Shader "Example/Diffuse Texture" {
    Properties {
      _MainTex ("Texture", 2D) = "white" { }
    }
    SubShader {
      Tags { "RenderType" = "Opaque" }
      CGPROGRAM
      #pragma surface surf Lambert
      struct Input {
          float2 uv_MainTex;
      };
      sampler2D _MainTex;
      void surf (Input IN, inout SurfaceOutput o) {
          o.Albedo = tex2D (_MainTex, IN.uv_MainTex).rgb;
      }
      ENDCG
    }
    Fallback "Diffuse"
  }

以下は、テクスチャがある場合と、実際のテクスチャがない場合にどのように見えるかの例です (1 つのディレクショナル ライトがシーンにあります)。 \\
Attach:SurfaceShaderDiffuseTexture.png Attach:SurfaceShaderDiffuseNoTex.png


まったく同じ事をしますが、組み込みのランバート ライティング モデルを使用する代わりに、''自身のライティング モデル''を記述します。 [[SL-SurfaceShaderLighting | Surface Shader Lighting Models]] は、記述する必要のある関数です。 以下は簡単なランバート ライティング モデルです。 ''シェーダ部分''自体は変わりませんでした (グレーアウトサれています):

  %gray%Shader "Example/Diffuse Texture" {
  %gray%  Properties {
  %gray%    _MainTex ("Texture", 2D) = "white" {}
  %gray%  }
  %gray%  SubShader {
  %gray%    Tags { "RenderType" = "Opaque" }
  %gray%    CGPROGRAM
      #pragma surface surf __SimpleLambert__
      
      half4 LightingSimpleLambert (SurfaceOutput s, half3 lightDir, half atten) {
          half NdotL = dot (s.Normal, lightDir);
          half4 c;
          c.rgb = s.Albedo * _LightColor0.rgb * (NdotL * atten * 2);
          c.a = s.Alpha;
          return c;
      }
      
  %gray%    struct Input {
  %gray%        float2 uv_MainTex;
  %gray%    };
  %gray%    sampler2D _MainTex;
  %gray%    void surf (Input IN, inout SurfaceOutput o) {
  %gray%        o.Albedo = tex2D (_MainTex, IN.uv_MainTex).rgb;
  %gray%  }
  %gray%    ENDCG
  %gray%  }
  %gray%  Fallback "Diffuse"
  %gray%  }

そのため、ここでの簡単なデフューズ ライティング モデルは、@@LightingSimpleLambert@@ 関数です。 表面法線と光方向間のドット積を行うことでライティングを計算し、光の軽減および色を適用します。


!! デフューズ ラップ

以下はラップされたデフューズ、デフューズ ライティングの変形で、照明がオブジェクトの端を''ラップ''します。 サブ表面散乱効果のフェークに便利です。 改めて言いますが、サーフェスシェーダ自体はまったく変わっていません。別のライティング関数を使用しているだけです。

  %gray%Shader "Example/Diffuse Wrapped" {
  %gray%  Properties {
  %gray%    _MainTex ("Texture", 2D) = "white" {}
  %gray%  }
  %gray%  SubShader {
  %gray%    Tags { "RenderType" = "Opaque" }
  %gray%    CGPROGRAM
      #pragma surface surf __WrapLambert__
      
      half4 LightingWrapLambert (SurfaceOutput s, half3 lightDir, half atten) {
          half NdotL = dot (s.Normal, lightDir);
          half diff = __NdotL * 0.5 + 0.5__;
          half4 c;
          c.rgb = s.Albedo * _LightColor0.rgb * (diff * atten * 2);
          c.a = s.Alpha;
          return c;
      }
      
  %gray%    struct Input {
  %gray%        float2 uv_MainTex;
  %gray%    };
  %gray%    sampler2D _MainTex;
  %gray%    void surf (Input IN, inout SurfaceOutput o) {
  %gray%        o.Albedo = tex2D (_MainTex, IN.uv_MainTex).rgb;
  %gray%  }
  %gray%    ENDCG
  %gray%  }
  %gray%  Fallback "Diffuse"
  %gray%  }


Attach:SurfaceShaderDiffuseWrap.png Attach:SurfaceShaderDiffuseWrapNoTex.png


!! トゥーン ランプ

以下は、表面が光と法線間の角度にどのように対応するかを定義するためにテクスチャを使用する''Ramp''ライティング モデルです。 これは、トゥーン ライティングなどの各種効果に使用できます。

  %gray%Shader "Example/Toon Ramp" {
  %gray%  Properties {
  %gray%    _MainTex ("Texture", 2D) = "white" {}
      ___Ramp ("Shading Ramp", 2D) = "gray" {}__
  %gray%  }
  %gray%  SubShader {
  %gray%    Tags { "RenderType" = "Opaque" }
  %gray%    CGPROGRAM
      #pragma surface surf __Ramp__
      
      sampler2D _Ramp;
      
      half4 LightingRamp (SurfaceOutput s, half3 lightDir, half atten) {
          half NdotL = dot (s.Normal, lightDir);
          half diff = NdotL * 0.5 + 0.5;
          __half3 ramp = tex2D (_Ramp, float2(diff)).rgb;__
          half4 c;
          c.rgb = s.Albedo * _LightColor0.rgb * ramp * (atten * 2);
          c.a = s.Alpha;
          return c;
      }
      
  %gray%    struct Input {
  %gray%        float2 uv_MainTex;
  %gray%    };
  %gray%    sampler2D _MainTex;
  %gray%    void surf (Input IN, inout SurfaceOutput o) {
  %gray%        o.Albedo = tex2D (_MainTex, IN.uv_MainTex).rgb;
  %gray%  }
  %gray%    ENDCG
  %gray%  }
  %gray%  Fallback "Diffuse"
  %gray%  }


Attach:SurfaceShaderToonRamp.png Attach:SurfaceShaderToonRampNoTex.png

Attach:SurfaceShaderToonRampItself.png


!! 簡単なスペキュラ

以下は簡単なスペキュラ ライティング モデルです。 組み込みの BlinnPhong が実際に行うことを非常に簡単に行えます。ここでは、どのように行われるかを例示するためにこれを挿入します。

  %gray%Shader "Example/Simple Specular" {
  %gray%  Properties {
  %gray%    _MainTex ("Texture", 2D) = "white" {}
  %gray%  }
  %gray%  SubShader {
  %gray%    Tags { "RenderType" = "Opaque" }
  %gray%    CGPROGRAM
      #pragma surface surf SimpleSpecular
      
      half4 LightingSimpleSpecular (SurfaceOutput s, half3 lightDir, half3 viewDir, half atten) {
          half3 h = normalize (lightDir + viewDir);
          
          half diff = max (0, dot (s.Normal, lightDir));
          
          float nh = max (0, dot (s.Normal, h));
          float spec = pow (nh, 48.0);
          
          half4 c;
          c.rgb = (s.Albedo * _LightColor0.rgb * diff + _LightColor0.rgb * spec) * (atten * 2);
          c.a = s.Alpha;
          return c;
      }
      
  %gray%    struct Input {
  %gray%        float2 uv_MainTex;
  %gray%    };
  %gray%    sampler2D _MainTex;
  %gray%    void surf (Input IN, inout SurfaceOutput o) {
  %gray%        o.Albedo = tex2D (_MainTex, IN.uv_MainTex).rgb;
  %gray%  }
  %gray%    ENDCG
  %gray%  }
  %gray%  Fallback "Diffuse"
  %gray%  }


Attach:SurfaceShaderSimpleSpecular.png Attach:SurfaceShaderSimpleSpecularNoTex.png
